var lemn=function(t){"use strict";const e=11;function n(t,n){const{firstChild:a,lastChild:r}=function(t){return t.nodeType===e?t:{firstChild:t,lastChild:t}}(n);(a.ref=t.start=a.ref||t.start).dom=a,(r.endRef=t.end=r.endRef||t.end).dom=r}function a(t){const e=document.createRange();return e.setStartBefore(t.start.dom),e.setEndAfter(t.end.dom),e.extractContents(),e}function r(t,e){const r=a(t);n(t,e),r.insertNode(e)}function i(t,e){t.attr.dom.removeAttribute(t.attr.name),"object"==typeof e?Object.assign(t.attr.dom[t.attr.name],e):t.attr.dom[t.attr.name]=e}function s(t){return t.some(Array.isArray)?s([].concat(...t)):t}const o="BIND_PREFIX";function d(t,...e){const n=[t[0],...s(e.map((e,n)=>[e,t[n+1]]))],a=n.map((t,e)=>"object"==typeof t||"function"==typeof t?`<link class=${o}${e}>`:t).join("")||" ",d=document.createRange().createContextualFragment(a);return n.forEach((t,e)=>{if("object"==typeof t||"function"==typeof t){const n=d.querySelector(`.${o}${e}`);n?t.nodeType?r({start:{dom:n},end:{dom:n}},t):(t.ref={start:{dom:n},end:{dom:n}},d.components=[...d.components||[],t]):Array.from(d.querySelectorAll("*")).some(n=>Array.from(n.attributes).some(a=>{if(a.value===`<link class=${o}${e}>`)return t.render?(t.ref={attr:{dom:n,name:a.name}},d.components=[...d.components||[],t]):i({attr:{dom:n,name:a.name}},t),!0}))}}),d}function h(t,e){t&&t.call(e)}function c(t){h(t.willDetach,t)}function l(t){h(t.didAttach,t)}function u(t){if(h(t.willRender,t),t.ref.attr)i(t.ref,t.render()||"");else{const n=(e=t.render()||"").nodeType?e:d`${e}`;r(t.ref,n),(t.ref.components||[]).forEach(t=>!(n.components||[]).includes(t)&&c(t)),(n.components||[]).forEach(u),(n.components||[]).forEach(e=>!(t.ref.components||[]).includes(e)&&l(e)),t.ref.components=n.components||[]}var e;h(t.didRender,t)}function f(t){return Promise.resolve(t).then(u)}class m{constructor(t={}){this.activeChildren=[],this.data=t}set(t){this.data=t,this.activeChildren.forEach(e=>e.push(t))}unbind(t){this.activeChildren=this.activeChildren.filter(e=>e!==t)}bind(t){this.activeChildren=[...this.activeChildren,t]}pull(){return this.data}to(t){return new p(this,t)}toJSON(){return this.data}}class p{constructor(t,e){this.parent=t,this.fn=e,this.attached=!1,this.activeChildren=null,this.oldParentData=null,this.data=null,this.pull()}willDetach(){this.attached&&(this.parent.unbind(this),this.attached=!1,this.oldParentData=null,this.data=null)}didAttach(){this.attached||(this.attached=!0,this.parent.bind(this))}to(t){return new p(this,t)}unbind(t){this.activeChildren=this.activeChildren.filter(e=>e!==t),this.parent.unbind(this)}bind(t){this.parent.bind(this),this.activeChildren=[...this.activeChildren||[],t]}pull(){const t=this.parent.pull();return this.oldParentData!==t&&(this.oldParentData=t,this.data=this.fn(t,this.data)||this.data),this.data}push(t){if(this.oldParentData!==t){this.oldParentData=t;const e=this.fn(t,this.data);null!==e&&(this.data=e,(this.activeChildren||[]).forEach(t=>t.push(e)),this.attached&&f(this))}}render(){return this.data}}return t.h=d,t.attach=function(t,e){t.appendChild(d`${e}`),u(e),l(e)},t.detach=function(t){c(t),a(t.ref)},t.rerender=f,t.Component=class{rerender(){return f(this)}render(){}},t.Store=class{constructor(t={}){this.data={};for(const e in t)this.data[e]=new m(t[e])}get(t){return t in this.data?this.data[t].data:{}}set(t,e){(this.data[t]=this.data[t]||new m).set(e)}to(t,e=(t=>t)){return(this.data[t]=this.data[t]||new m).to(e)}toJSON(){return this.data}},t}({});
