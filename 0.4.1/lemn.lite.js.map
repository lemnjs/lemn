{"version":3,"file":"lemn.lite.js","sources":["../src/tag.js","../src/lifecycle.js"],"sourcesContent":["const DOCUMENT_FRAGMENT_NODE = 11;\n\nfunction startEndNodes (replaceWith) {\n  if (replaceWith.nodeType === DOCUMENT_FRAGMENT_NODE) {\n    return replaceWith;\n  }\n  return {firstChild: replaceWith, lastChild: replaceWith};\n}\n\nfunction setRefRange (refRange, replaceWith) {\n  const {firstChild, lastChild} = startEndNodes(replaceWith);\n\n  (firstChild.lemnRef = (refRange.lemnPrivateStart = (firstChild.lemnRef || refRange.lemnPrivateStart))).lemnPrivateDom = firstChild;\n  (lastChild.lemnEndRef = (refRange.lemnPrivateEnd = (lastChild.lemnEndRef || refRange.lemnPrivateEnd))).lemnPrivateDom = lastChild;\n}\n\nfunction removeRef (refRange) {\n  const range = document.createRange();\n  range.setStartBefore(refRange.lemnPrivateStart.lemnPrivateDom);\n  range.setEndAfter(refRange.lemnPrivateEnd.lemnPrivateDom);\n  range.extractContents();\n  return range;\n}\n\nfunction replace (refRange, replaceWith) {\n  const range = removeRef(refRange);\n  setRefRange(refRange, replaceWith);\n  range.insertNode(replaceWith);\n}\n\n/**\n * @private\n * @param {object|function|string|number|boolean} replaceWith\n */\nfunction replaceAttr ({lemnPrivateAttr: {lemnPrivateDom, lemnPrivateName}}, replaceWith) {\n  lemnPrivateDom.removeAttribute(lemnPrivateName);\n  if (Array.isArray(replaceWith)) {\n    lemnPrivateDom[lemnPrivateName] = replaceWith.join(' ');\n  } else if (typeof replaceWith === 'object') {\n    Object.assign(lemnPrivateDom[lemnPrivateName], replaceWith);\n  } else {\n    lemnPrivateDom[lemnPrivateName] = replaceWith;\n  }\n}\n\nfunction flatten (array) {\n  if (array.some(Array.isArray)) {\n    return flatten([].concat(...array));\n  }\n  return array;\n}\n\nconst BIND_PREFIX = 'lemn';\n\n/**\n * A template string tag that turns the strings and input objects into lemnPrivateDom\n * elements.\n *\n * @param {Array.<string>} strings\n * @param {Array} ...exprs\n *\n * @example\n * h`<div></div>`\n *\n * @example\n * h`<div style=\"${{fontSize: '2em'}}\">Big Text</div>`\n *\n * @example\n * h`<div onclick=\"${ev => console.log('clicked!')}\">Click Me</div>`\n *\n * @example\n * h`<div>${{render() {return h`output`;}}}</div>`\n *\n * @example\n * h`<div>${new MyComponent()}</div>`\n */\nfunction h (strings, ..._exprs) {\n  const exprs = [strings[0], ...flatten(_exprs.map((expr, i) => [expr, strings[i + 1]]))];\n\n  let template;\n  Object.defineProperty(exprs, 'content', {\n    get () {\n      if (!template) {\n        const out = exprs.map((expr, i) => (\n          (typeof expr === 'object' || typeof expr === 'function') ?\n            `<link class=${BIND_PREFIX}${i}>` :\n            expr\n        )).join('') || ' ';\n\n        template = document.createRange().createContextualFragment(out);\n      }\n\n      const content = template.cloneNode(true);\n\n      exprs.forEach((expr, i) => {\n        if (typeof expr === 'object' || typeof expr === 'function') {\n          const toReplace = content.querySelector(`.${BIND_PREFIX}${i}`);\n          if (toReplace) {\n            if (!expr.nodeType) {\n              expr.lemnRef = {...expr.lemnRef, lemnPrivateStart: {lemnPrivateDom: toReplace}, lemnPrivateEnd: {lemnPrivateDom: toReplace}};\n              content.lemnPrivateComponents = [...(content.lemnPrivateComponents || []), expr];\n            } else {\n              replace({lemnPrivateStart: {lemnPrivateDom: toReplace}, lemnPrivateEnd: {lemnPrivateDom: toReplace}}, expr);\n            }\n          } else {\n            Array.from(content.querySelectorAll('*')).some(el => {\n              return Array.from(el.attributes).some(attr => {\n                if (attr.value === `<link class=${BIND_PREFIX}${i}>`) {\n                  const attrName = attr.name === 'class' ? 'className' : attr.name;\n                  if (expr.render) {\n                    expr.lemnRef = {lemnPrivateAttr: {lemnPrivateDom: el, lemnPrivateName: attrName}};\n                    content.lemnPrivateComponents = [...(content.lemnPrivateComponents || []), expr];\n                  } else {\n                    replaceAttr({lemnPrivateAttr: {lemnPrivateDom: el, lemnPrivateName: attrName}}, expr);\n                  }\n                  return true;\n                }\n              });\n            });\n          }\n        }\n      });\n\n      return content;\n    }\n  });\n\n  return exprs;\n}\n\nexport {\n  setRefRange,\n  removeRef,\n  replace,\n  replaceAttr,\n  flatten,\n  h,\n  BIND_PREFIX,\n};\n","import {removeRef, replace, replaceAttr, h} from './tag';\n\nfunction toFragment (replaceWith) {\n    if (replaceWith.nodeType) {\n        return replaceWith;\n    }\n    return h`${replaceWith}`.content;\n}\n\nfunction maybeCall (fn, _this) {\n    fn && fn.call(_this);\n}\n\nfunction willDetach (expr) {\n    maybeCall(expr.willDetach, expr);\n}\n\nfunction didAttach (expr) {\n    maybeCall(expr.didAttach, expr);\n}\n\nfunction performRender (expr) {\n    maybeCall(expr.willRender, expr);\n\n    if (expr.lemnRef.lemnPrivateAttr) {\n      replaceAttr(expr.lemnRef, expr.render() || '');\n    } else {\n      const fragment = toFragment(expr.render() || ' ');\n\n      (expr.lemnRef.lemnPrivateComponents || []).forEach(v => !(fragment.lemnPrivateComponents || []).includes(v) && willDetach(v));\n      (fragment.lemnPrivateComponents || []).forEach(component => performRender(component));\n      (fragment.lemnPrivateComponents || []).forEach(v => !(expr.lemnRef.lemnPrivateComponents || []).includes(v) && didAttach(v));\n      expr.lemnRef.lemnPrivateComponents = (fragment.lemnPrivateComponents || []);\n\n      replace(expr.lemnRef, fragment);\n    }\n\n    maybeCall(expr.didRender, expr);\n}\n\n/**\n * Queue to call a component's render method later and inject its returned\n * value into the dom.\n *\n * @param {Component} component - rerender this component soon\n */\nfunction rerender (expr) {\n    return Promise.resolve(expr).then(performRender);\n}\n\n/**\n * Attach a component into some root node.\n *\n * @param {HTMLElement} root - html element to attach component under\n * @param {Component} component - component to render\n */\nfunction attach(root, expr) {\n    root.appendChild(toFragment(expr));\n    performRender(expr);\n    didAttach(expr);\n}\n\n/**\n * Detach a component from the dom.\n *\n * @param {Component} component - component to detach from parent dom\n */\nfunction detach(expr) {\n    willDetach(expr);\n    removeRef(expr.lemnRef);\n}\n\nexport {\n    toFragment,\n    maybeCall,\n    performRender,\n    rerender,\n    attach,\n    detach,\n};\n"],"names":[],"mappings":"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"}